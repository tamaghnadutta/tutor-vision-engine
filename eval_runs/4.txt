(env) tamaghnadutta@Tamaghnas-MacBook-Air meraki_labs % make eval
python scripts/run_eval.py
/Users/tamaghnadutta/Downloads/meraki_labs/env/lib/python3.10/site-packages/pydantic/_internal/_generate_schema.py:404: UserWarning: <built-in function any> is not a Python type (it may be an instance of an object), Pydantic will allow any object with no validation since we cannot even enforce that the input is an instance of the given type. To get rid of this error wrap the type with `pydantic.SkipValidation`.
  warn(
2025-09-13 17:52:15 - __main__ - INFO - Starting evaluation harness with real data
2025-09-13 17:52:15 - src.data.dataset - INFO - Loaded 4 samples from dataset
2025-09-13 17:52:15 - __main__ - INFO - Evaluating baseline model (OCR+LLM)
2025-09-13 17:52:15 - src.models.error_detector - INFO - Mapping legacy approach 'ocr_llm' to 'gemini'
2025-09-13 17:52:15 - src.models.robust_model_router - INFO - Initialized RobustMultiModelProcessor with gemini provider
2025-09-13 17:52:15 - src.models.gemini_processor - INFO - Initialized Gemini client successfully
2025-09-13 17:52:15 - src.models.error_detector - INFO - Initialized ErrorDetector with gemini approach
2025-09-13 17:52:15 - src.eval.evaluator - INFO - Starting evaluation of baseline_ocr_llm
2025-09-13 17:52:15 - src.models.robust_model_router - INFO - Starting robust parallel image processing with gemini...
2025-09-13 17:52:15 - src.models.robust_model_router - INFO - Starting robust parallel image processing with gemini...
2025-09-13 17:52:15 - root - INFO - AFC is enabled with max remote calls: 10.
2025-09-13 17:52:15 - root - INFO - AFC is enabled with max remote calls: 10.
2025-09-13 17:52:15 - root - INFO - AFC is enabled with max remote calls: 10.
2025-09-13 17:52:15 - root - INFO - AFC is enabled with max remote calls: 10.
2025-09-13 17:52:28 - src.models.robust_model_router - INFO - Robust parallel processing completed successfully with gemini
2025-09-13 17:52:28 - root - INFO - AFC is enabled with max remote calls: 10.
2025-09-13 17:52:31 - src.models.robust_model_router - INFO - Robust parallel processing completed successfully with gemini
2025-09-13 17:52:31 - root - INFO - AFC is enabled with max remote calls: 10.
2025-09-13 17:52:42 - src.models.robust_model_router - INFO - Robust image analysis completed in 26.68s using gemini
2025-09-13 17:52:42 - src.models.error_detector - INFO - Robust multi-model error detection completed: has_error=False, confidence=0.950, duration=26.74s using gemini
2025-09-13 17:52:42 - src.models.robust_model_router - INFO - Starting robust parallel image processing with gemini...
2025-09-13 17:52:42 - root - INFO - AFC is enabled with max remote calls: 10.
2025-09-13 17:52:42 - root - INFO - AFC is enabled with max remote calls: 10.
2025-09-13 17:52:44 - src.models.robust_model_router - INFO - Robust image analysis completed in 29.27s using gemini
2025-09-13 17:52:44 - src.models.error_detector - INFO - Robust multi-model error detection completed: has_error=True, confidence=0.900, duration=29.33s using gemini
2025-09-13 17:52:44 - src.models.robust_model_router - INFO - Starting robust parallel image processing with gemini...
2025-09-13 17:52:44 - root - INFO - AFC is enabled with max remote calls: 10.
2025-09-13 17:52:44 - root - INFO - AFC is enabled with max remote calls: 10.
2025-09-13 17:53:00 - src.models.robust_model_router - INFO - Robust parallel processing completed successfully with gemini
2025-09-13 17:53:00 - root - INFO - AFC is enabled with max remote calls: 10.
2025-09-13 17:53:09 - src.models.robust_model_router - INFO - Robust parallel processing completed successfully with gemini
2025-09-13 17:53:09 - root - INFO - AFC is enabled with max remote calls: 10.
2025-09-13 17:53:30 - src.models.robust_model_router - WARNING - Retrying <unknown> in 4.0 seconds as it raised TimeoutError: .
2025-09-13 17:53:34 - root - INFO - AFC is enabled with max remote calls: 10.
2025-09-13 17:53:38 - src.models.robust_model_router - ERROR - Gemini math analysis failed: 503 UNAVAILABLE. {'error': {'code': 503, 'message': 'The model is overloaded. Please try again later.', 'status': 'UNAVAILABLE'}}
2025-09-13 17:53:38 - src.models.robust_model_router - WARNING - Retrying <unknown> in 4.0 seconds as it raised ServerError: 503 UNAVAILABLE. {'error': {'code': 503, 'message': 'The model is overloaded. Please try again later.', 'status': 'UNAVAILABLE'}}.
2025-09-13 17:53:42 - root - INFO - AFC is enabled with max remote calls: 10.
2025-09-13 17:53:44 - src.models.robust_model_router - INFO - Robust image analysis completed in 61.69s using gemini
2025-09-13 17:53:44 - src.models.error_detector - INFO - Robust multi-model error detection completed: has_error=True, confidence=0.950, duration=61.72s using gemini
2025-09-13 17:53:51 - src.models.robust_model_router - INFO - Robust image analysis completed in 66.44s using gemini
2025-09-13 17:53:51 - src.models.error_detector - INFO - Robust multi-model error detection completed: has_error=True, confidence=0.950, duration=66.47s using gemini
2025-09-13 17:53:51 - src.eval.evaluator - INFO - Evaluation completed for baseline_ocr_llm: accuracy=1.000, latency_p95=66.47s
2025-09-13 17:53:51 - __main__ - INFO - Evaluating improved model (Hybrid)
2025-09-13 17:53:51 - src.models.error_detector - INFO - Mapping legacy approach 'hybrid' to 'auto'
2025-09-13 17:53:51 - src.models.robust_model_router - INFO - Initialized RobustMultiModelProcessor with openai provider
2025-09-13 17:53:51 - src.models.gemini_processor - INFO - Initialized Gemini client successfully
2025-09-13 17:53:51 - src.models.error_detector - INFO - Initialized ErrorDetector with openai approach
2025-09-13 17:53:51 - src.eval.evaluator - INFO - Starting evaluation of improved_hybrid
2025-09-13 17:53:51 - src.models.robust_model_router - INFO - Starting robust parallel image processing with openai...
2025-09-13 17:53:51 - src.models.robust_model_router - INFO - Starting robust parallel image processing with openai...
2025-09-13 17:53:58 - src.models.robust_model_router - INFO - Robust parallel processing completed successfully with openai
2025-09-13 17:54:03 - src.models.robust_model_router - INFO - Robust image analysis completed in 11.49s using openai
2025-09-13 17:54:03 - src.models.error_detector - INFO - Robust multi-model error detection completed: has_error=True, confidence=0.950, duration=11.50s using openai
2025-09-13 17:54:03 - src.models.robust_model_router - INFO - Starting robust parallel image processing with openai...
2025-09-13 17:54:06 - src.models.robust_model_router - INFO - Robust parallel processing completed successfully with openai
2025-09-13 17:54:14 - src.models.robust_model_router - INFO - Robust parallel processing completed successfully with openai
2025-09-13 17:54:14 - src.models.robust_model_router - INFO - Robust image analysis completed in 22.89s using openai
2025-09-13 17:54:14 - src.models.error_detector - INFO - Robust multi-model error detection completed: has_error=True, confidence=0.900, duration=22.91s using openai
2025-09-13 17:54:14 - src.models.robust_model_router - INFO - Starting robust parallel image processing with openai...
2025-09-13 17:54:17 - src.models.robust_model_router - INFO - Robust image analysis completed in 14.86s using openai
2025-09-13 17:54:17 - src.models.error_detector - INFO - Robust multi-model error detection completed: has_error=True, confidence=0.950, duration=14.87s using openai
2025-09-13 17:54:26 - src.models.robust_model_router - INFO - Robust parallel processing completed successfully with openai
2025-09-13 17:54:32 - src.models.robust_model_router - INFO - Robust image analysis completed in 18.06s using openai
2025-09-13 17:54:32 - src.models.error_detector - INFO - Robust multi-model error detection completed: has_error=True, confidence=0.950, duration=18.09s using openai
2025-09-13 17:54:32 - src.eval.evaluator - INFO - Evaluation completed for improved_hybrid: accuracy=0.750, latency_p95=22.91s
2025-09-13 17:54:32 - __main__ - INFO - Results saved to ./data/eval_results/evaluation_results.json

================================================================================
ERROR DETECTION API - EVALUATION RESULTS
================================================================================

Core Performance Metrics:
+----------------------+----------------------+---------------------+---------------+
| Metric               |   Baseline (OCR+LLM) |   Improved (Hybrid) | Improvement   |
+======================+======================+=====================+===============+
| Accuracy             |                1     |               0.75  | -0.250        |
+----------------------+----------------------+---------------------+---------------+
| F1 Score             |                1     |               0.857 | -0.143        |
+----------------------+----------------------+---------------------+---------------+
| Step-Level Accuracy  |                0.704 |               0.704 | +0.000        |
+----------------------+----------------------+---------------------+---------------+
| Error Detection Rate |                1     |               1     | N/A           |
+----------------------+----------------------+---------------------+---------------+

Latency Metrics (seconds):
+--------------+------------+------------+---------------+
| Percentile   |   Baseline |   Improved |   Improvement |
+==============+============+============+===============+
| p50          |      61.72 |      18.09 |         43.63 |
+--------------+------------+------------+---------------+
| p90          |      66.47 |      22.91 |         43.56 |
+--------------+------------+------------+---------------+
| p95          |      66.47 |      22.91 |         43.56 |
+--------------+------------+------------+---------------+

Cost Estimation (per 100 requests):
+--------------------+------------------+---------------------------------------------+
| Model              | Estimated Cost   | Notes                                       |
+====================+==================+=============================================+
| Baseline (OCR+LLM) | $0.60            | Gemini 2.5 Flash (thinking_budget=0)        |
+--------------------+------------------+---------------------------------------------+
| Improved (Hybrid)  | $0.60            | Gemini 2.5 Flash Vision (thinking_budget=0) |
+--------------------+------------------+---------------------------------------------+

================================================================================
2025-09-13 17:54:32 - __main__ - INFO - Evaluation completed successfully
(env) tamaghnadutta@Tamaghnas-MacBook-Air meraki_labs % 